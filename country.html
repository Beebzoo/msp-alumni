<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country - MSP Alumni Network</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --dark-blue: #001C3D;
            --light-blue: #00A2DB;
            --orange: #E84E10;
            --white: #FFFFFF;
            --off-white: #f8f9fa;
            --gray-100: #f5f5f5;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-800: #343a40;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--dark-blue);
            background: var(--white);
        }
        
        /* Header */
        header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--dark-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
        }
        
        .logo-text {
            font-size: 15px;
            font-weight: 700;
            color: var(--dark-blue);
        }
        
        .back-link {
            font-size: 14px;
            color: var(--light-blue);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-link:hover {
            color: var(--dark-blue);
        }
        
        /* Hero */
        .hero {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: calc(100vh - 70px);
        }
        
        .hero-left {
            display: flex;
            flex-direction: column;
        }
        
        .flag-section {
            flex: 1;
            position: relative;
            overflow: hidden;
            min-height: 280px;
        }
        
        .flag-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .flag-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to bottom, transparent, var(--dark-blue));
        }
        
        .info-section {
            background: var(--dark-blue);
            padding: 40px 45px;
            color: white;
        }
        
        .country-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--light-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }
        
        .country-name {
            font-size: 42px;
            font-weight: 800;
            letter-spacing: -1.5px;
            line-height: 1.1;
            margin-bottom: 8px;
        }
        
        .country-native {
            font-size: 15px;
            color: rgba(255,255,255,0.5);
            font-style: italic;
            margin-bottom: 15px;
        }
        
        .country-region {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        .quick-facts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
        }
        
        .fact {
            border-left: 3px solid var(--light-blue);
            padding-left: 12px;
        }
        
        .fact.orange {
            border-left-color: var(--orange);
        }
        
        .fact-value {
            font-size: 15px;
            font-weight: 700;
        }
        
        .fact-label {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Hero Right - Map */
        .hero-right {
            position: relative;
            background: var(--gray-100);
        }
        
        #heroMap {
            width: 100%;
            height: 100%;
            min-height: 450px;
        }
        
        .map-overlay {
            position: absolute;
            bottom: 25px;
            left: 25px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .map-overlay-title {
            font-size: 11px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .map-overlay-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--dark-blue);
        }
        
        /* Stats Section */
        .stats-section {
            padding: 70px 50px;
            background: white;
        }
        
        .stats-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .section-header {
            margin-bottom: 30px;
        }
        
        .section-header h2 {
            font-size: 26px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 8px;
        }
        
        .section-header p {
            font-size: 15px;
            color: var(--gray-600);
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
        }
        
        .stat-card {
            background: var(--gray-100);
            padding: 30px 25px;
            border-left: 4px solid var(--orange);
        }
        
        .stat-card.blue {
            border-left-color: var(--light-blue);
        }
        
        .stat-card.dark {
            border-left-color: var(--dark-blue);
        }
        
        .stat-number {
            font-size: 44px;
            font-weight: 800;
            color: var(--dark-blue);
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray-600);
        }
        
        /* Graphs Section */
        .graphs-section {
            padding: 70px 50px;
            background: var(--gray-100);
        }
        
        .graphs-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .graphs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }
        
        .graph-card {
            background: white;
            padding: 28px;
            border-radius: 8px;
        }
        
        .graph-card.full-width {
            grid-column: span 2;
        }
        
        .graph-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 22px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--gray-200);
        }
        
        /* Bar Chart */
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .bar-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .bar-label {
            font-size: 13px;
            color: var(--gray-800);
            min-width: 140px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bar-flag {
            width: 22px;
            height: 15px;
            border-radius: 2px;
            object-fit: cover;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .bar-track {
            flex: 1;
            height: 22px;
            background: var(--gray-100);
            position: relative;
            border-radius: 2px;
        }
        
        .bar-fill {
            height: 100%;
            background: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            min-width: 30px;
            border-radius: 2px;
        }
        
        .bar-fill.orange { background: var(--orange); }
        .bar-fill.dark { background: var(--dark-blue); }
        
        /* Donut */
        .donut-container {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .donut-chart {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .donut-center {
            width: 85px;
            height: 85px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .donut-center-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--dark-blue);
        }
        
        .donut-center-label {
            font-size: 10px;
            color: var(--gray-600);
            text-transform: uppercase;
        }
        
        .donut-legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }
        
        .legend-value {
            font-weight: 600;
            margin-left: auto;
            color: var(--dark-blue);
        }
        
        /* Year Timeline */
        .year-timeline {
            display: flex;
            align-items: flex-end;
            gap: 6px;
            height: 160px;
            padding-top: 25px;
        }
        
        .year-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .year-bar-fill {
            width: 100%;
            background: var(--light-blue);
            position: relative;
            min-height: 6px;
            border-radius: 2px 2px 0 0;
        }
        
        .year-bar-value {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: 600;
            color: var(--dark-blue);
        }
        
        .year-bar-label {
            font-size: 10px;
            color: var(--gray-600);
        }
        
        /* Universities Section */
        .universities-section {
            padding: 70px 50px;
            background: white;
        }
        
        .universities-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .uni-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .uni-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
        }
        
        .uni-card:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        .uni-card-header {
            height: 80px;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }
        
        .uni-card-header img {
            max-height: 50px;
            max-width: 110px;
            object-fit: contain;
        }
        
        .uni-card-body {
            padding: 18px;
        }
        
        .uni-card-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 3px;
            line-height: 1.3;
        }
        
        .uni-card-city {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 12px;
        }
        
        .uni-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--gray-200);
        }
        
        .uni-card-count {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-blue);
        }
        
        .uni-card-count span {
            font-size: 11px;
            font-weight: 400;
            color: var(--gray-600);
        }
        
        .uni-card-arrow {
            color: var(--orange);
            font-size: 16px;
        }
        
        /* Cities Section */
        .cities-section {
            padding: 70px 50px;
            background: var(--gray-100);
        }
        
        .cities-container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .cities-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 25px;
        }
        
        .city-button {
            background: var(--orange);
            color: white;
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
        }
        
        .city-button span {
            font-weight: 700;
        }
        
        .city-button.alt {
            background: white;
            color: var(--dark-blue);
            border: 1px solid var(--gray-200);
        }
        
        /* Coming Soon */
        .coming-soon {
            text-align: center;
            padding: 60px 20px;
            background: var(--gray-100);
            border-radius: 12px;
        }
        
        .coming-soon-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .coming-soon h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 10px;
        }
        
        .coming-soon p {
            font-size: 15px;
            color: var(--gray-600);
            max-width: 400px;
            margin: 0 auto;
        }
        
        /* Footer */
        footer {
            padding: 40px 50px;
            background: var(--dark-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-logo {
            color: white;
            font-size: 14px;
            font-weight: 500;
        }
        
        .footer-links {
            display: flex;
            gap: 25px;
        }
        
        .footer-links a {
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            font-size: 13px;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        /* Leaflet Popup */
        .leaflet-popup-content-wrapper {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 0;
        }
        
        .leaflet-popup-content {
            margin: 0;
            font-family: 'Inter', sans-serif;
            min-width: 200px;
        }
        
        .leaflet-popup-tip {
            background: white;
        }
        
        .popup-card {
            padding: 16px;
        }
        
        .popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .popup-logo {
            width: 40px;
            height: 40px;
            background: var(--gray-100);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }
        
        .popup-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .popup-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark-blue);
        }
        
        .popup-city {
            font-size: 12px;
            color: var(--gray-600);
        }
        
        .popup-count {
            font-size: 24px;
            font-weight: 700;
            color: var(--light-blue);
            padding-top: 10px;
            border-top: 1px solid var(--gray-200);
        }
        
        .popup-count span {
            font-size: 12px;
            font-weight: 400;
            color: var(--gray-600);
        }
        
        /* Responsive */
        @media (max-width: 1000px) {
            .hero {
                grid-template-columns: 1fr;
            }
            
            .hero-right {
                height: 350px;
            }
            
            .stats-row {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .graphs-grid {
                grid-template-columns: 1fr;
            }
            
            .graph-card.full-width {
                grid-column: span 1;
            }
            
            .uni-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .cities-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            header {
                padding: 12px 20px;
            }
            
            .info-section {
                padding: 30px 20px;
            }
            
            .country-name {
                font-size: 32px;
            }
            
            .quick-facts {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            
            .stats-section,
            .graphs-section,
            .universities-section,
            .cities-section {
                padding: 50px 20px;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .donut-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .bar-label {
                min-width: 100px;
                font-size: 11px;
            }
            
            .uni-grid {
                grid-template-columns: 1fr;
            }
            
            .cities-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            footer {
                flex-direction: column;
                gap: 15px;
                padding: 30px 20px;
                text-align: center;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <a href="index.html" class="logo">
            <span class="logo-icon">UM</span>
            <span class="logo-text">MSP Alumni Network</span>
        </a>
        <a href="index.html" class="back-link">‚Üê Back to World Map</a>
    </header>
    
    <!-- Hero -->
    <section class="hero">
        <div class="hero-left">
            <div class="flag-section">
                <img id="flagImg" class="flag-img" src="" alt="Flag">
                <div class="flag-overlay"></div>
            </div>
            <div class="info-section">
                <div class="country-label">Country Profile</div>
                <h1 class="country-name" id="countryName">Loading...</h1>
                <p class="country-native" id="countryNative"></p>
                <p class="country-region" id="countryRegion"></p>
                
                <div class="quick-facts">
                    <div class="fact">
                        <div class="fact-value" id="factCapital">-</div>
                        <div class="fact-label">Capital</div>
                    </div>
                    <div class="fact">
                        <div class="fact-value" id="factPopulation">-</div>
                        <div class="fact-label">Population</div>
                    </div>
                    <div class="fact orange">
                        <div class="fact-value" id="factArea">-</div>
                        <div class="fact-label">Area (km¬≤)</div>
                    </div>
                    <div class="fact">
                        <div class="fact-value" id="factCurrency">-</div>
                        <div class="fact-label">Currency</div>
                    </div>
                    <div class="fact">
                        <div class="fact-value" id="factLanguage">-</div>
                        <div class="fact-label">Language</div>
                    </div>
                    <div class="fact orange">
                        <div class="fact-value" id="factTimezone">-</div>
                        <div class="fact-label">Timezone</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="hero-right">
            <div id="heroMap"></div>
            <div class="map-overlay">
                <div class="map-overlay-title">Universities</div>
                <div class="map-overlay-value" id="uniCount">-</div>
            </div>
        </div>
    </section>
    
    <!-- Stats Section -->
    <section class="stats-section">
        <div class="stats-container">
            <div class="section-header">
                <h2>MSP Alumni Statistics</h2>
                <p>Overview of Maastricht Science Programme graduates connected to this country.</p>
            </div>
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-number" id="statTotal">-</div>
                    <div class="stat-label">Total Alumni</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-number" id="statLiving">-</div>
                    <div class="stat-label">Currently Living Here</div>
                </div>
                <div class="stat-card dark">
                    <div class="stat-number" id="statStudied">-</div>
                    <div class="stat-label">Studied Here</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statUnis">-</div>
                    <div class="stat-label">Universities</div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Graphs Section -->
    <section class="graphs-section" id="graphsSection">
        <div class="graphs-container">
            <div class="section-header">
                <h2>Alumni Demographics</h2>
                <p>Detailed breakdown of alumni characteristics and trends.</p>
            </div>
            
            <div class="graphs-grid" id="graphsGrid">
                <!-- Graduation Years -->
                <div class="graph-card full-width">
                    <div class="graph-title">Alumni by Graduation Year</div>
                    <div class="year-timeline" id="yearTimeline"></div>
                </div>
                
                <!-- Gender -->
                <div class="graph-card" id="genderCard">
                    <div class="graph-title">Gender Distribution</div>
                    <div class="donut-container">
                        <div class="donut-chart" id="genderDonut"></div>
                        <div class="donut-legend" id="genderLegend"></div>
                    </div>
                </div>
                
                <!-- Origins -->
                <div class="graph-card" id="originsCard">
                    <div class="graph-title">Where They Come From</div>
                    <div class="bar-chart" id="originChart"></div>
                </div>
                
                <!-- Nationalities -->
                <div class="graph-card full-width" id="nationalitiesCard">
                    <div class="graph-title">Top Nationalities</div>
                    <div class="bar-chart" id="nationalitiesChart"></div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Universities Section -->
    <section class="universities-section" id="universitiesSection">
        <div class="universities-container">
            <div class="section-header">
                <h2>Universities</h2>
                <p>Institutions where MSP alumni have continued their academic journey.</p>
            </div>
            
            <div class="uni-grid" id="universityGrid"></div>
        </div>
    </section>
    
    <!-- Cities Section -->
    <section class="cities-section" id="citiesSection">
        <div class="cities-container">
            <div class="section-header">
                <h2>Where Alumni Live</h2>
                <p>Cities across the country where our graduates have settled.</p>
            </div>
            
            <div class="cities-grid" id="citiesGrid"></div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="footer-logo">Maastricht University ¬∑ Faculty of Science and Engineering</div>
        <div class="footer-links">
            <a href="index.html">World Map</a>
            <a href="mailto:msp-alumni@maastrichtuniversity.nl">Contact</a>
        </div>
    </footer>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Alumni Data -->
    <script src="alumni-data.js"></script>
    
    <script>
        // ============================================
        // GET COUNTRY FROM URL
        // ============================================
        
        const urlParams = new URLSearchParams(window.location.search);
        const countryParam = urlParams.get('country') || 'Netherlands';
        
        // Get country data from the alumni database
        let countryData = alumniDatabase[countryParam];
        
        // If country not found, try to find by display name or redirect to Netherlands
        if (!countryData) {
            const found = Object.entries(alumniDatabase).find(([key, data]) => 
                data.displayName.toLowerCase() === countryParam.toLowerCase() ||
                key.toLowerCase() === countryParam.toLowerCase()
            );
            countryData = found ? found[1] : alumniDatabase["Netherlands"];
        }
        
        // ============================================
        // FETCH COUNTRY INFO FROM REST COUNTRIES API
        // ============================================
        
        async function fetchCountryInfo() {
            try {
                const response = await fetch(`https://restcountries.com/v3.1/alpha/${countryData.code}`);
                const data = await response.json();
                const country = data[0];
                
                document.title = `${countryData.displayName} - MSP Alumni`;
                document.getElementById('flagImg').src = country.flags.svg;
                document.getElementById('countryName').textContent = countryData.displayName;
                
                // Native name
                const nativeNames = country.name.nativeName;
                if (nativeNames) {
                    const firstNative = Object.values(nativeNames)[0];
                    if (firstNative.common && firstNative.common !== country.name.common) {
                        document.getElementById('countryNative').textContent = firstNative.common;
                    }
                }
                
                document.getElementById('countryRegion').textContent = `${country.subregion} ¬∑ ${country.region}`;
                document.getElementById('factCapital').textContent = country.capital?.[0] || '-';
                document.getElementById('factPopulation').textContent = formatPopulation(country.population);
                document.getElementById('factArea').textContent = formatNumber(country.area);
                
                if (country.currencies) {
                    const currencyKey = Object.keys(country.currencies)[0];
                    const currency = country.currencies[currencyKey];
                    document.getElementById('factCurrency').textContent = `${currency.symbol || ''} ${currencyKey}`;
                }
                
                if (country.languages) {
                    document.getElementById('factLanguage').textContent = Object.values(country.languages)[0];
                }
                
                if (country.timezones) {
                    document.getElementById('factTimezone').textContent = country.timezones[0];
                }
            } catch (error) {
                console.error('Error fetching country info:', error);
                document.getElementById('countryName').textContent = countryData.displayName;
            }
        }
        
        // ============================================
        // HELPERS
        // ============================================
        
        function formatPopulation(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(0) + 'K';
            return num.toString();
        }
        
        function formatNumber(num) {
            return num?.toLocaleString() || '-';
        }
        
        function getFlagUrl(code) {
            return `https://flagcdn.com/w40/${code.toLowerCase()}.png`;
        }
        
        // ============================================
        // POPULATE STATS
        // ============================================
        
        function populateStats() {
            document.getElementById('statTotal').textContent = countryData.total;
            document.getElementById('statLiving').textContent = countryData.living || '-';
            document.getElementById('statStudied').textContent = countryData.studied || '-';
            
            const uniCount = countryData.universities ? countryData.universities.length : 0;
            document.getElementById('statUnis').textContent = uniCount || '-';
            document.getElementById('uniCount').textContent = uniCount || '-';
        }
        
        // ============================================
        // MAP
        // ============================================
        
        function initMap() {
            const map = L.map('heroMap', {
                zoomControl: false,
                attributionControl: false
            }).setView(countryData.coordinates, countryData.zoom);
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            
            if (countryData.universities && countryData.universities.length > 0) {
                countryData.universities.forEach(uni => {
                    const size = Math.max(8, Math.min(uni.count / 3, 22));
                    
                    const marker = L.circleMarker([uni.lat, uni.lng], {
                        radius: size,
                        fillColor: '#00A2DB',
                        color: '#ffffff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                    
                    marker.bindPopup(`
                        <div class="popup-card">
                            <div class="popup-header">
                                <div class="popup-logo">
                                    <img src="assets/logos/${uni.logo}" alt="${uni.name}" onerror="this.parentElement.innerHTML='üéì'">
                                </div>
                                <div>
                                    <div class="popup-name">${uni.name}</div>
                                    <div class="popup-city">${uni.city}</div>
                                </div>
                            </div>
                            <div class="popup-count">${uni.count} <span>alumni</span></div>
                        </div>
                    `, { maxWidth: 250 });
                    
                    marker.on('mouseover', function() {
                        this.setStyle({ fillOpacity: 1, radius: size * 1.15 });
                    });
                    marker.on('mouseout', function() {
                        this.setStyle({ fillOpacity: 0.8, radius: size });
                    });
                });
            } else {
                // Just show country marker
                L.circleMarker(countryData.coordinates, {
                    radius: 15,
                    fillColor: '#00A2DB',
                    color: '#ffffff',
                    weight: 2,
                    fillOpacity: 0.8
                }).addTo(map);
            }
        }
        
        // ============================================
        // CHARTS
        // ============================================
        
        function createCharts() {
            if (!countryData.hasDetailedData) {
                // Show limited data message
                document.getElementById('graphsSection').innerHTML = `
                    <div class="graphs-container">
                        <div class="section-header">
                            <h2>Alumni Demographics</h2>
                            <p>Limited data available for this country due to privacy thresholds.</p>
                        </div>
                        <div class="coming-soon">
                            <div class="coming-soon-icon">üìä</div>
                            <h3>Limited Data Available</h3>
                            <p>We have ${countryData.total} alumni connected to ${countryData.displayName}. Detailed breakdowns require larger sample sizes to protect privacy.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Graduation years timeline
            if (countryData.graduationYears) {
                createYearTimeline();
            }
            
            // Gender donut
            if (countryData.gender) {
                createGenderChart();
            } else {
                document.getElementById('genderCard').style.display = 'none';
            }
            
            // Origins bar chart
            if (countryData.origins) {
                createBarChart('originChart', countryData.origins, 'dark');
            } else {
                document.getElementById('originsCard').style.display = 'none';
            }
            
            // Nationalities bar chart
            if (countryData.nationalities && Object.keys(countryData.nationalities).length > 0) {
                createNationalitiesChart();
            } else {
                document.getElementById('nationalitiesCard').style.display = 'none';
            }
        }
        
        function createYearTimeline() {
            const container = document.getElementById('yearTimeline');
            const years = countryData.graduationYears;
            const maxVal = Math.max(...Object.values(years));
            
            // Get all years from 2014 to 2025
            for (let year = 2014; year <= 2025; year++) {
                const count = years[year] || 0;
                const height = count > 0 ? (count / maxVal) * 120 : 4;
                const bar = document.createElement('div');
                bar.className = 'year-bar';
                bar.innerHTML = `
                    <div class="year-bar-fill" style="height: ${height}px; ${count === 0 ? 'background: #e0e0e0;' : ''}">
                        ${count > 0 ? `<span class="year-bar-value">${count}</span>` : ''}
                    </div>
                    <div class="year-bar-label">'${String(year).slice(-2)}</div>
                `;
                container.appendChild(bar);
            }
        }
        
        function createGenderChart() {
            const female = countryData.gender.Female;
            const male = countryData.gender.Male;
            const total = female + male;
            const femalePct = (female / total) * 100;
            
            const donut = document.getElementById('genderDonut');
            donut.style.background = `conic-gradient(#00A2DB 0% ${femalePct}%, #E84E10 ${femalePct}% 100%)`;
            donut.innerHTML = `<div class="donut-center"><div class="donut-center-value">${total}</div><div class="donut-center-label">Total</div></div>`;
            
            document.getElementById('genderLegend').innerHTML = `
                <div class="legend-item">
                    <div class="legend-color" style="background:#00A2DB"></div>
                    <span>Female</span>
                    <span class="legend-value">${female} (${femalePct.toFixed(0)}%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background:#E84E10"></div>
                    <span>Male</span>
                    <span class="legend-value">${male} (${(100-femalePct).toFixed(0)}%)</span>
                </div>
            `;
        }
        
        function createBarChart(containerId, data, colorClass) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const maxVal = Math.max(...Object.values(data));
            
            Object.entries(data).forEach(([label, value]) => {
                const pct = (value / maxVal) * 100;
                const row = document.createElement('div');
                row.className = 'bar-row';
                row.innerHTML = `
                    <div class="bar-label">${label}</div>
                    <div class="bar-track"><div class="bar-fill ${colorClass}" style="width: ${pct}%">${value}</div></div>
                `;
                container.appendChild(row);
            });
        }
        
        function createNationalitiesChart() {
            const container = document.getElementById('nationalitiesChart');
            if (!container || !countryData.nationalities) return;
            
            const data = countryData.nationalities;
            const maxVal = Math.max(...Object.values(data));
            
            Object.entries(data).forEach(([nationality, value]) => {
                const pct = (value / maxVal) * 100;
                const flagCode = nationalityFlags[nationality] || '';
                const flagHtml = flagCode ? `<img src="${getFlagUrl(flagCode)}" alt="" class="bar-flag">` : '';
                
                const row = document.createElement('div');
                row.className = 'bar-row';
                row.innerHTML = `
                    <div class="bar-label">${flagHtml}${nationality}</div>
                    <div class="bar-track"><div class="bar-fill orange" style="width: ${pct}%">${value}</div></div>
                `;
                container.appendChild(row);
            });
        }
        
        // ============================================
        // UNIVERSITIES
        // ============================================
        
        function populateUniversities() {
            const grid = document.getElementById('universityGrid');
            
            if (!countryData.universities || countryData.universities.length === 0) {
                document.getElementById('universitiesSection').innerHTML = `
                    <div class="universities-container">
                        <div class="section-header">
                            <h2>Universities</h2>
                            <p>University destination data for ${countryData.displayName}.</p>
                        </div>
                        <div class="coming-soon">
                            <div class="coming-soon-icon">üéì</div>
                            <h3>No University Data</h3>
                            <p>We don't have enough data on universities in ${countryData.displayName} yet. Most alumni who live here studied elsewhere.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            countryData.universities.forEach(uni => {
                const card = document.createElement('div');
                card.className = 'uni-card';
                card.innerHTML = `
                    <div class="uni-card-header">
                        <img src="assets/logos/${uni.logo}" alt="${uni.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'font-size:32px\\'>üéì</div>'">
                    </div>
                    <div class="uni-card-body">
                        <div class="uni-card-name">${uni.name}</div>
                        <div class="uni-card-city">${uni.city}</div>
                        <div class="uni-card-footer">
                            <div class="uni-card-count">${uni.count} <span>alumni</span></div>
                            <div class="uni-card-arrow">‚Üí</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // ============================================
        // CITIES
        // ============================================
        
        function populateCities() {
            const grid = document.getElementById('citiesGrid');
            
            if (!countryData.cities || countryData.cities.length === 0) {
                document.getElementById('citiesSection').style.display = 'none';
                return;
            }
            
            countryData.cities.forEach((city, i) => {
                const btn = document.createElement('div');
                btn.className = i < 4 ? 'city-button' : 'city-button alt';
                btn.innerHTML = `${city.name} <span>${city.count}</span>`;
                grid.appendChild(btn);
            });
        }
        
        // ============================================
        // INIT
        // ============================================
        
        fetchCountryInfo();
        populateStats();
        initMap();
        createCharts();
        populateUniversities();
        populateCities();
    </script>
</body>
</html>
